define(["jquery"],function(a){"use strict";var b={CIRCLE_RADIUS:null,CIRCLE_CIRCUMF:null,CIRCLE_CIRCUMF_HALF:null,METER_COLOUR:"#70d54a",WORDS_ANIMATION_DURATION:1e3,METER_FRAME_DURATION:3,METER_TOTAL_ANIMATION_DURATION:700,WORDS_TOTAL_ANIMATION_DURATION:1e3,WORD_COUNT_FRAME_DURATION:30},c=function(c,d){var e=a("#meter-"+c),f=b.CIRCLE_CIRCUMF_HALF-d*b.CIRCLE_CIRCUMF_HALF/100;e.find(".mask").attr("stroke-dasharray",f+","+b.CIRCLE_CIRCUMF),a("#meter-needle-"+c).css("transform","rotate("+(270+180*d/100)+"deg)"),e.attr("data-percent",d)},d=function(e,f,g,h){var i=parseInt(a("#meter-"+e).attr("data-percent"));void 0!==i&&i<f?(c(e,i+h),setTimeout(function(){d(e,f,g,h)},b.METER_FRAME_DURATION)):(c(e,f),a("#meter-"+e+"-legend-val").html(g),a("#meter-"+e+"-legend").fadeIn(500))},e=function(c,d,f,g){void 0===g&&(g=a("#wordcount-"+c));var h=isNaN(parseInt(g.html()))?0:parseInt(g.html());h<d?(g.html(h+f),setTimeout(function(){e(c,d,f,g)},b.WORD_COUNT_FRAME_DURATION)):g.html(d)},f=function(a,c,d){var e=1,g=parseInt(d.attr("data-complete")),h=function(){d.attr("data-complete",(g+e).toString()),d.find("#line-"+(g-1).toString()).css("stroke",b.METER_COLOUR),d.find("#circle-"+g.toString()).css("fill",b.METER_COLOUR),d.find("#complete-num-complete-"+a).html(g.toString())};g<c?(h(),setTimeout(function(){f(a,c,d)},Math.ceil(b.WORDS_ANIMATION_DURATION/c))):g<=c&&h()},g=function(a,b,c,d){void 0===d&&(d=1),d<=b&&(c.find("#progress-cell-"+d.toString()).addClass("complete"),c.find("#complete-num-complete-"+a).html(d.toString())),d<b&&setTimeout(function(){g(a,b,c,d+1)},200)},h=function(b,c){var d=a("#dots-indicator-grid-"+b);0===d.length?(d=a("#dots-indicator-path-"+b),d.fadeIn(200),f(b,c,d)):g(b,c,d)},i=function(a,c){var f=parseInt(c.wpm),g=200,i=0===f?0:Math.floor(f/g*100),j=Math.ceil(b.METER_TOTAL_ANIMATION_DURATION/i/b.METER_FRAME_DURATION);d(a+"-1",i,f,j);var k=parseInt(c.score);j=Math.ceil(b.METER_TOTAL_ANIMATION_DURATION/k/b.METER_FRAME_DURATION),d(a+"-2",k,k,j);var l=parseInt(c.totalwordsread),m=Math.ceil(l/(b.WORDS_TOTAL_ANIMATION_DURATION/b.WORD_COUNT_FRAME_DURATION));e(a,l,m),setTimeout(function(){h(a,c.countcmsattempted)},b.METER_TOTAL_ANIMATION_DURATION)},j=function(b,d){var e=b+"-1",f=parseInt(d.wpm),g=200,i=0===f?0:Math.floor(f/g*100);c(e,i),a("#meter-"+e+"-legend-val").html(f),a("#meter-"+e+"-legend").fadeIn(500),e=b+"-2";var j=parseInt(d.score);c(e,j),a("#meter-"+e+"-legend-val").html(j),a("#meter-"+e+"-legend").fadeIn(500),a("#wordcount-"+b).html(d.totalwordsread),h(b,d.countcmsattempted)};return{init:function(c,d,e){a(document).ready(function(){b.CIRCLE_RADIUS=d,b.CIRCLE_CIRCUMF=Math.floor(2*Math.PI*b.CIRCLE_RADIUS),b.CIRCLE_CIRCUMF_HALF=Math.floor(b.CIRCLE_CIRCUMF/2),e=parseInt(e);try{c=JSON.parse(c)}catch(f){c=[]}var g=a(".course-accordion-wrapper");if(g.length>0&&e&&Object.keys(c).length>0){var h=a("#course-collapse-"+e);h.hasClass("collapse")&&setTimeout(function(){h.collapse("show");var b=110;a("body, html").animate({scrollTop:h.offset().top-b},"slow")},300)}if(Object.keys(c).length>0)if(0===g.length){var k=a(".course-dash").attr("data-courseid");i(k,c[k])}else i(e,c[e]),setTimeout(function(){g.each(function(b,d){d=a(d).attr("data-courseid"),d!==e&&j(d,c[d])})},2e3)})}}});