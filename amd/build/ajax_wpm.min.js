define(["jquery"],function(a){"use strict";var b=30,c=2e4,d=function(b,e,f){void 0!==f&&void 0!==e&&f>e.length-1||require(["core/config","core/log"],function(g,h){var i=function(){var b=a('.flowerstats[data-aiwpm=""]'),c=[];b.each(function(b,d){d=a(d),c[d.attr("data-attemptid")]=d});var d=[];return c.forEach(function(a){d.push(a)}),d},j=function(){if(f===e.length-1){var a=i();a.length>0?(h.debug("Finished checking all for this round.  Will check again in milliseconds: "+c.toString()),setTimeout(function(){d(b-1,a,0)},c)):h.debug("Data complete.  Stopping polling")}else setTimeout(function(){d(b,e,f+1)},500)};if(e||(e=i(),f=0),h.debug("AJAX checks left before we give up: "+b.toString()),e.length>0&&b>0){var k=a(e[f]);h.debug("Polling for WPM data for attempt id: "+k.attr("data-attemptid")),a.post(g.wwwroot+"/blocks/readaloudstudent/ajaxhelper.php",{cmid:k.attr("data-cmid"),action:1,data:k.attr("data-attemptid")}).done(function(b){if(h.debug("AJAX response received"),b.success===!0)if(b.data!==-1&&a.isNumeric(b.data)){var c=a(".wpm-"+k.attr("data-attemptid"));c.fadeOut(300,function(){c.html(b.data).fadeIn(300)}),k.attr("data-aiwpm",b.data),a("#recent-attempt-flowerstats-"+k.attr("data-attemptid")).find(".flowerstats").attr("data-aiwpm",b.data)}else h.debug("AJAX response shows data not ready");else h.error("Error obtaining WPM data by AJAX"),h.debug(b);j()}).fail(function(a,b,c){h.debug("AJAX fail for WPM request",a,b,c),j()})}})};return{init:function(){a(document).ready(function(){setTimeout(function(){d(b)},2e3)})}}});